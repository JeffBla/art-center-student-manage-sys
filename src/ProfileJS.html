<script>
  var username = document.getElementById('username').innerHTML;

  document.getElementById('check-btn').addEventListener('click', function() {
      var loading = document.getElementById('loading');
      var emptyContent = document.getElementById('empty-content');

      if(this.innerHTML == '檢視我的服務學習'){
          this.innerHTML = 'Close';
          
          // Show the loading spinner
          loading.style.display = 'block';
          
          // Run the Google script to fetch the data
          google.script.run.withSuccessHandler(function(tableContent) {
              if(Object.keys(tableContent).length === 0){
                emptyContent.style.display = 'block';
              } else {
                emptyContent.style.display = 'none';
                writeTableContent(tableContent);
              }
              
              // Hide the loading spinner after data is loaded
              loading.style.display = 'none';
              
          }).WriteServiceTable(username);
      } else if (this.innerHTML == 'Close'){
          emptyContent.style.display = 'none';
          this.innerHTML = '檢視我的服務學習';
          clearTable();
      }
  });

  function writeTableContent(tableContent) {
    for(let key in tableContent) {
      appendRow(key, tableContent[key]['time'], tableContent[key]['place'], tableContent[key]['hours'], tableContent[key]['note']);
    }
  }

  function appendRow(event, time, place, hours, note) {
    // Get the table element
    var table = document.getElementById("my-service");
    
    // Create a new row
    var newRow = table.insertRow();
    
    // Create and append cells to the new row
    var cell1 = newRow.insertCell(0);
    var cell2 = newRow.insertCell(1);
    var cell3 = newRow.insertCell(2);
    var cell4 = newRow.insertCell(3);
    var cell5 = newRow.insertCell(4);
    
    // Add content to each cell
    cell1.innerHTML = event;
    cell2.innerHTML = time;
    cell3.innerHTML = place;
    cell4.innerHTML = hours;
    cell5.innerHTML = note;
  }

  function clearTable() {
    var table = document.getElementById('my-service');
    
    // Remove all rows except the header (first row)
    var rowCount = table.rows.length;
    for (var i = rowCount - 1; i > 0; i--) {
      table.deleteRow(i);
    }
  }

  function getPersonalInfo() {
    var username = document.getElementById('username');
    google.script.run.withSuccessHandler(writePersonalInfo).readPersonalInfo(username.innerHTML);
  }

  function writePersonalInfo(personalInfo) {
    var student_id = document.getElementById('student-id');
    var email = document.getElementById('email');
    var phone = document.getElementById('phone');

    student_id.innerHTML = "學號: " + personalInfo[0];
    email.innerHTML = "Email: " + personalInfo[1];
    phone.innerHTML = "手機: " + personalInfo[2];

  }


</script>